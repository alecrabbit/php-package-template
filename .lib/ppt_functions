#!/usr/bin/env sh

_ppt_help_message () {
    echo "Usage:"
    echo "./${BASE_FILENAME} [options]"
    echo
    echo "Options:"
    echo "    -h                 - show this help message and exit"
    echo "    -y                 - do not ask questions"
    echo "    -p name            - package name"
    echo "    -o owner           - package owner"
    echo "    -n name            - package owner name"
    exit 0
}

_ppt_realpath ()
{
    if [ -x "$(command -v realpath)" ]
    then
        echo "$(realpath ${1})"
    else
        ppt_path_=${1}

        # prepend current directory to relative paths
        echo "${ppt_path_}" |grep '^/' >/dev/null 2>&1 \
            || ppt_path_="${PWD}/${ppt_path_}"

        # clean up the path. if all seds supported true regular expressions, then
        # this is what it would be:
        ppt_old_=${ppt_path_}
        while true; do
            ppt_new_=`echo "${ppt_old_}" | sed 's/[^/]*\/\.\.\/*//;s/\/\.\//\//'`
            [ "${ppt_old_}" = "${ppt_new_}" ] && break
            ppt_old_=${ppt_new_}
        done
        echo "${ppt_new_}"

        unset ppt_path_ ppt_old_ ppt_new_
    fi
}

_ppt_has_docker ()
{
    if [ ! -x "$(command -v docker)" ]
    then
        return ${PPT_FALSE}
    fi
    return ${PPT_TRUE}
}

_ppt_has_docker_compose ()
{
    if [ ! -x "$(command -v docker-compose)" ]
    then
        return ${PPT_FALSE}
    fi
    return ${PPT_TRUE}
}

_ppt_show_accepted_value () {
    echo "${__ppt_ansi_dark} Accepted value: '${1}'${__ppt_ansi_none}"
    echo
}
_ppt_ask_values () {
    package_name=$(_ppt_read_value "package name" "${package_name}" "" "It should be unique among your packages!")
    _ppt_show_accepted_value "${package_name}"
    package_owner=$(_ppt_read_value "package owner" "${package_owner}" "Used in composer.json line: \"name\": \"owner/name\")")
    _ppt_show_accepted_value "${package_owner}"
    package_owner_name=$(_ppt_read_value "package owner name" "${package_owner_name}" "Used in LICENSE file")
    _ppt_show_accepted_value "${package_owner_name}"
    package_description=$(_ppt_read_value "package description" "${package_description}" "Used in composer.json line: \"description\": \"Your awesome description\"")
    _ppt_show_accepted_value "${package_description}"
    package_namespace=$(_ppt_read_value "package namespace" "${package_namespace}")
    _ppt_show_accepted_value "${package_namespace}"
    package_owner_namespace=$(_ppt_read_value "package owner namespace" "${package_owner_namespace}")
    _ppt_show_accepted_value "${package_owner_namespace}"
    package_dir=$(_ppt_read_value "package dir" "${package_dir}" "" "It should be new non-existent yet dir name!")
    _ppt_show_accepted_value "${package_dir}"


#    __ppt_ask_question "Are you ready?"
#    if [ $? -eq ${PPT_TRUE} ]
#    then
#        _ppt_info "OK"
#    fi
}

#add_origin () {
#    param_package_owner="$1"
#    param_package_name="$2"
#    _ppt_do_add_origin="$3"
#    _ppt_vcs_service="$4"
#    remote="https://github.com/${param_package_owner}/${param_package_name}.git"
#    ask_question "Add remote on '${remote}'?"
#    if [[ $? -eq 1 ]]
#    then
#        git remote add origin "${remote}"
#        dark "Added remote ${remote}"
#        echo
#    fi
#}
#
__ppt_ask_question () {
    printf "${1} [y/n] "
    __ppt_old_stty_cfg=$(stty -g)
    stty raw -echo
#    __ppt_answer=$( while ! head -c 1 | grep -i '[ny]' ;do true ;done )  # only yn accepted
    __ppt_answer=$(head -c 1)  # anything accepted
    stty ${__ppt_old_stty_cfg}
    unset __ppt_old_stty_cfg
    echo
    if echo "$__ppt_answer" | grep -iq "^y" ;then
        unset __ppt_answer
        return ${PPT_TRUE}
    fi
    unset __ppt_answer
    return ${PPT_FALSE}
}
#__ppt_ask_question () {
#    while true; do
#        read -p "${1} " yn
#        case $yn in
#            [Yy]* ) return ${PPT_TRUE}; break;;
#            [Nn]* ) return ${PPT_FALSE};;
#            * ) echo "Please answer yes or no.";;
#        esac
#    done
#}

_ppt_read_value () {
    __ppt_value_name=${1}
    __ppt_result=${2}
    __ppt_comment=${3:-}
    __ppt_notice=${4:-}
    __ppt_space=" "

    if [ ! -z "${__ppt_notice}" ]
    then
        __ppt_notice=$(printf "${__ppt_ansi_bold_yellow}${__ppt_notice}${__ppt_ansi_none}\n ")
        __ppt_space=""
    fi
    if [ ! -z "${__ppt_comment}" ]
    then
        __ppt_comment=$(printf "${__ppt_ansi_dark}(${__ppt_comment})${__ppt_ansi_none}\n ")
    fi
    __ppt_question=$(printf "${__ppt_space}Enter ${__ppt_value_name}:\n ")
    __ppt_question="${__ppt_notice}${__ppt_question}${__ppt_comment}[${__ppt_result}] "

    read -p "${__ppt_question}" __ppt_input
    echo "${__ppt_input:-$__ppt_result}"
    unset __ppt_value_name __ppt_question __ppt_comment __ppt_result __ppt_notice __ppt_input __ppt_space
}

